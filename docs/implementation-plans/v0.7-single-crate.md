# Version 0.7: Real-World Integration & Single Crate - Implementation Plan

**Status:** ðŸš§ **IN PROGRESS**

**Goal:** Consolidate architecture and implement critical features for real-world integration (Remote Connection, API Polish) to validate v1.0 readiness.

**Releases:**
- v0.7.0: Single Crate Architecture (2025-11-16)
- v0.7.1: Script & Style Injection APIs (2025-12-24) - Community contribution
- v0.7.2: Community Features & Fixes (2025-12-24) - Storage state, debugging, logging
- v0.7.3: Remote Connection (Planned)

**Related:**
- [Roadmap](../roadmap.md)
- [ADR 0003: Single Crate Architecture](../adr/0003-single-crate-architecture.md)

---

## Vertical Slices

### Slice 1: Consolidation (v0.7.0)

**Goal:** Merge `playwright-core` functionality into `playwright` and publish.

**Motivation:** Issue #3 discovered during Folio integration revealed fundamental complexity in two-crate split. All official Playwright implementations use single packages.

**Key Deliverables:**
- [x] Move `playwright-core` code into `playwright` crate
- [x] Update dependencies and build scripts
- [x] Verify all tests pass in single-crate structure
- [x] Publish `playwright-rs` v0.7.0
- [x] Publish `playwright-core` v0.6.2 with deprecation notice
- [x] Update documentation to reflect single-crate usage

**Technical Decisions:**
- Kept `playwright-core` as a shell for deprecation/redirect.
- Updated `driver` handling to be internal to the main crate.

---

### Slice 2: Script & Style Injection APIs (v0.7.1)

**Status:** âœ… **COMPLETE** (2025-12-24)

**Goal:** Add script and style injection capabilities to pages and contexts.

**Key Deliverables:**
- [x] `BrowserContext.add_init_script()` - Context-level script injection
- [x] `Page.add_init_script()` - Page-level script injection
- [x] `Page.add_style_tag()` - CSS injection with full Playwright API compatibility
- [x] `AddStyleTagOptions` struct with builder pattern (content, url, path)
- [x] Cross-browser test coverage (Chromium, Firefox, WebKit)
- [x] Error case testing
- [x] Published as v0.7.1

**Technical Decisions:**
- Used options struct with builder pattern (matches existing codebase conventions)
- Added file path support (bonus feature beyond original PR)
- Comprehensive validation with clear error messages

**Community Credit:**
- Original implementation by @douglasob (PR #7)
- Code review and enhancements by maintainers

---

### Slice 3: Community Features & Fixes (v0.7.2)

**Status:** âœ… **COMPLETE** (2025-12-24)

**Goal:** Address community-reported issues for storage state, debugging, and logging.

**Key Deliverables:**
- [x] Storage State Support (Issue #6)
  - `BrowserContextOptions::storage_state()` for inline StorageState
  - `BrowserContextOptions::storage_state_path()` for JSON file loading
  - New types: `Cookie`, `LocalStorageItem`, `Origin`, `StorageState`
  - Async file reading with proper error handling
  - Cross-browser compatibility (Chromium, Firefox, WebKit)
- [x] Debugging Support (Issue #5)
  - `Page::pause()` method for manual debugging with Playwright Inspector
  - `BrowserContext::pause()` protocol support
- [x] Logging Improvements (Issue #4)
  - Consistent tracing initialization across all integration tests
  - Protocol error visibility improvements
  - Better debugging experience during test development

**Technical Decisions:**
- Storage state file reading happens in `Browser::new_context_with_options` before serialization (matches playwright-python)
- Builder methods are mutually exclusive (setting inline clears path, vice versa)
- Used `#[serde(rename_all = "camelCase")]` for automatic field name conversion
- Protocol serialization fixed for methods with no arguments

**Community Credit:**
- Issues reported and discussed by: @cbmarc, @SergeyBibikov

---

### Slice 4: Remote Connection (v0.7.3)

**Status:** ðŸ”´ **Not Started**

**Goal:** Implement `BrowserType::connect` for remote browser connection (critical for CI/CD).

**User Story:** As a developer, I want to connect to a remote Playwright browser (e.g., in Docker or BrowserStack) so I can run tests in CI/CD environments.

**Tasks:**
- [ ] Define `ConnectOptions` struct (ws_endpoint, headers, slow_mo, timeout)
- [ ] Implement `BrowserType::connect(url, options)`
- [ ] Implement `BrowserType::connect_over_cdp(url, options)` (optional)
- [ ] Verify `Transport` WebSocket support (add tungstenite dependency)
- [ ] Add integration tests (launch server separately, connect to it)

---

### Slice 5: Critical Feature Gaps (v0.7.4)

**Status:** ðŸ”´ **Not Started**

**Goal:** Address critical missing features and stability issues identified in the gap analysis.

**Tasks:**
- [ ] **[CRITICAL]** Audit `Locator` API (specifically `select_option`, `set_input_files`)
- [ ] Implement `WebSocket` event handling (`on_websocket`)

---

### Slice 6: API Polish & DX (v0.7.5)

**Status:** ðŸ”´ **Not Started**

**Goal:** Improve developer experience and API completeness before v1.0.

**Tasks:**
- [ ] Implement `FilePayload` struct
- [ ] Add `BrowserContext` options
- [ ] Review `Route` API overrides
- [ ] Improve error messages based on Folio feedback
